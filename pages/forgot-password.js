import Axios from "axios";
import Head from "next/head";
import Image from "next/image";
import { useState } from "react";
import styles from "../styles/Home.module.css";
import * as CONSTANTS from "./../utils/constants";

export default function Home() {
  const [ForgotUser, setForgotUser] = useState({
    otp: "",
    email: "",
    password: "",
  });

  const [haveEmail, setHaveEmail] = useState(false);

  return (
    <div className={styles.container}>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <div>
        <input
          type={"email"}
          name="email"
          value={ForgotUser.email}
          disabled={haveEmail}
          onChange={(e) =>
            setForgotUser({ ...ForgotUser, [e.target.name]: e.target.value })
          }
        />
        <br />
        {haveEmail && (
          <>
            {" "}
            <input
              type={"text"}
              name="otp"
              value={ForgotUser.OTP}
              onChange={(e) =>
                setForgotUser({
                  ...ForgotUser,
                  [e.target.name]: e.target.value,
                })
              }
              placeholder={"otp"}
            />
            <input
              type={"text"}
              name="password"
              value={ForgotUser.password}
              onChange={(e) =>
                setForgotUser({
                  ...ForgotUser,
                  [e.target.name]: e.target.value,
                })
              }
              placeholder={"New Password"}
            />
            <button
              onClick={() => {
                const user = Axios.post("/api/reset", ForgotUser)
                  .then((res) => {
                    console.log("r3", { data: res.data });
                  })
                  .catch((err) => {
                    console.error;
                  });
              }}
            >
              Change Password
            </button>
          </>
        )}

        {!haveEmail && (
          <button
            onClick={() => {
              const user = Axios.post("/api/forgot", ForgotUser)
                .then((res) => {
                  if (res.data.msg === "sent") setHaveEmail(true);
                })
                .catch((err) => {
                  console.error;
                });
            }}
          >
            Get OTP
          </button>
        )}
      </div>
    </div>
  );
}
